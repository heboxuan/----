var User={},wait_max=120,wait_tmp=wait_max,totalPage=0;User.initUserThreadsPage=function(){var a=Common.getPageParamsByRequest(["type","stype"]),e=Common.getPageParamsByAnchor();null==a.type&&isNaN(a.type)&&(a.type=0),-1==a.type&&null==a.stype&&isNaN(a.stype)&&(a.stype=1);var t=e.page;$("#pager").sjAjaxPager({url:CONTEXT_PATH+"/user/queryThreads",pageSize:10,pageIndex:t,searchParam:a,totalCount:-1,beforeSend:function(){$("#list_content").empty(),$("#list_content").append("<div style='text-align:center' id='loading_img'><img src='-+CONTEXT_PATH+-/static/www/images/loading.gif'/*tpa=http://liuyan.people.com.cn/static/www/js/"+CONTEXT_PATH+"/static/www/images/loading.gif*/ /></div>")},success:function(e){if($("#loading_img").remove(),0<=e.responseData.total){if(0==a.type)$.each(e.responseData.rows,function(e,t){$("#list_content").append(tmpl("dcl_threads_content_tpl",t))});else if(1==a.type)$.each(e.responseData.rows,function(e,t){$("#list_content").append(tmpl("threads_content_tpl",t))});else if(2==a.type)$.each(e.responseData.rows,function(e,t){$("#list_content").append(tmpl("trash_threads_content_tpl",t))});else if(-1==a.type){var t=$('<div class="shisiwu_subType"></div>');0==a.stype?t.append('<a class="select" href="http://liuyan.people.com.cn/static/www/js/'+CONTEXT_PATH+'/user/threads?type=-1&stype=0">待处理</a>'):t.append('<a href="http://liuyan.people.com.cn/static/www/js/'+CONTEXT_PATH+'/user/threads?type=-1&stype=0">待处理</a>'),1==a.stype?t.append('<a class="select"  href="http://liuyan.people.com.cn/static/www/js/'+CONTEXT_PATH+'/user/threads?type=-1&stype=1">已展示</a>'):t.append('<a href="http://liuyan.people.com.cn/static/www/js/'+CONTEXT_PATH+'/user/threads?type=-1&stype=1">已展示</a>'),2==a.stype?t.append('<a class="select"  href="http://liuyan.people.com.cn/static/www/js/'+CONTEXT_PATH+'/user/threads?type=-1&stype=2">未展示</a>'):t.append('<a href="http://liuyan.people.com.cn/static/www/js/'+CONTEXT_PATH+'/user/threads?type=-1&stype=2">未展示</a>'),$("#list_content").append(t),$.each(e.responseData.rows,function(e,t){0==a.stype?$("#list_content").append(tmpl("dcl_threads_content_tpl",t)):1==a.stype?$("#list_content").append(tmpl("threads_content_tpl",t)):2==a.stype&&$("#list_content").append(tmpl("trash_threads_content_tpl",t))})}totalPage=parseInt((e.responseData.total+10-1)/10)}else $("#list_content").append("<div style='text-align:center'>该项目中没有留言</div>")},complete:function(){a.page===totalPage?Ajax.post(CONTEXT_PATH+"/user/myOverdueThreads",{type:a.type},function(e){console.log(e.responseData),0<e.responseData?$("#msgTips").show():$("#msgTips").hide()}):$("#msgTips").hide(),Common.addAnchorByAjaxPageParams(),paintWatermark()}})},User.initUserMsgPage=function(){var t=Common.getPageParamsByRequest(["type"]),e=Common.getPageParamsByAnchor();null==t.type&&isNaN(t.type)&&(t.type=0);var a=e.page;$("#pager").sjAjaxPager({url:CONTEXT_PATH+"/user/queryMsg?type="+t.type,pageSize:10,pageIndex:a,totalCount:-1,beforeSend:function(){$("#list_content").empty(),$("#list_content").append("<div style='text-align:center' id='loading_img'><img src='-+CONTEXT_PATH+-/static/www/images/loading.gif'/*tpa=http://liuyan.people.com.cn/static/www/js/"+CONTEXT_PATH+"/static/www/images/loading.gif*/ /></div>")},success:function(e){$("#loading_img").remove(),console.info("处理前:",e),0<e.responseData.total?0==t.type?($.each(e.responseData.rows,function(e,t){t.result=User.getResultInfo(t),$("#list_content").append(tmpl("alert_content_tpl",t))}),console.info("处理后:",e.responseData.rows)):$.each(e.responseData.rows,function(e,t){$("#list_content").append(tmpl("notice_content_tpl",t))}):$("#list_content").append("<div style='text-align:center'>未查询到结果</div>"),e.responseData.total<=10?$("#pager").hide():$("#pager").show()},complete:function(){Common.addAnchorByAjaxPageParams()},error:function(e,t,a){$("#loading_img").remove()}})},User.initUserInfoPage=function(){$("#editForm").validate({rules:{realName:"validChineseName",certicification:"validCertification"},messages:{realName:"请输入真实姓名",certicification:"请输入正确的身份证号码"},submitHandler:function(e){$("#editsubmit").attr("disabled",!0),Ajax.formAjaxSubmit(e,function(e){"success"==e.result?layer.msg("操作成功",{time:1e3,icon:6}):(layer.alert("操作失败",{icon:5}),console.log(e.responseData)),$("#editsubmit").attr("disabled",!1)})}})},User.time=function(e){0==wait_tmp?(e.removeClass("send"),e.html("发送验证短信"),wait_tmp=wait_max):(e.html("重新发送("+wait_tmp+")"),wait_tmp--,setTimeout(function(){User.time(e)},1e3))},User.initMobileRegPage=function(){$("#regForm").validate({rules:{verCode:"required",userName:{required:!0,validPhone:!0,remote:{url:CONTEXT_PATH+"/checkPropValid",type:"post",dataType:"json",data:{prop:"userName",value:function(){return $("#userName").val()},regType:2}}},password:{required:!0,rangelength:[8,20],validPassword:!0},password2:{required:!0,equalTo:"#password"},nickName:{required:!0,rangelength:[2,12],remote:{url:CONTEXT_PATH+"/checkPropValid",type:"post",dataType:"json",data:{prop:"nickName",value:function(){return $("#nickName").val()},regType:2}}},validateCode:"required"},messages:{verCode:"请输入验证码",userName:{required:"请输入用户名",validPhone:"使用手机注册必须使用正确的手机号码",remote:"用户名已被注册"},password:{required:"请输入密码",rangelength:"密码长度应在8至20个字符之间",validPassword:"密码不能包含特殊字符"},password2:{required:"请再次输入密码",equalTo:"两次输入密码不一致，请重新输入"},nickName:{required:"请输入用户笔名",rangelength:"笔名长度应该2至12个字符之间",remote:"笔名已被注册"},validateCode:"请输入手机验证码"},submitHandler:function(e){$("#submit_btn").attr("disabled",!0),Ajax.formAjaxSubmit(e,function(e){if("success"==e.result)location.href=CONTEXT_PATH+"/regOk";else{layer.alert(e.responseData,{icon:5});var t=(new Date).valueOf();$("#codeImg").attr("src",CONTEXT_PATH+"/verifycode/rand4?timestamp="+t),$("#verCode").val("")}$("#submit_btn").attr("disabled",!1)})}}),$("#btn_getCode").click(function(){if(wait_tmp==wait_max){var e=$("#verCode").val(),t=$("#userName").val();if(""==t)return layer.alert("请输入手机号码！",{icon:5}),!1;if(""==e)return layer.alert("请输入验证码！",{icon:5}),!1;Ajax.post(CONTEXT_PATH+"/getCode","phoneNum="+t+"&verCode="+e,function(e){if("success"!=e.result)return 1301==e.responseData?layer.tips("该用户名已被注册","#userName",{time:5e3,tips:[2,"#FF6666"]}):1009==e.responseData?layer.tips("2分钟内不能重复发送验证码","#userName",{time:5e3,tips:[1,"#FF6666"]}):1010==e.responseData?layer.tips("验证码发送已达规定次数","#userName",{time:5e3,tips:[1,"#FF6666"]}):layer.alert(e.responseData,{icon:5}),!1;layer.msg("获取验证码成功",{time:1e3,icon:6});var t=$("#btn_getCode");t.addClass("send"),wait_tmp==wait_max&&User.time(t)})}}),$("#refreshImg").click(function(){var e=(new Date).valueOf();$("#codeImg").attr("src",CONTEXT_PATH+"/verifycode/rand4?t="+e)})},User.initEmailRegPage=function(){$("#refreshImg").click(function(){var e=(new Date).valueOf();$("#codeImg").attr("src",CONTEXT_PATH+"/verifycode/rand4?t="+e)}),$("#regForm").validate({rules:{verCode:"required",userName:{required:!0,validEmail:!0,remote:{url:CONTEXT_PATH+"/checkPropValid",type:"post",dataType:"json",data:{prop:"userName",value:function(){return $("#userName").val()},regType:1}}},password:{required:!0,rangelength:[8,20],validPassword:!0},password2:{required:!0,equalTo:"#password"},nickName:{required:!0,rangelength:[2,12],remote:{url:CONTEXT_PATH+"/checkPropValid",type:"post",dataType:"json",data:{prop:"nickName",value:function(){return $("#nickName").val()},regType:1}}}},messages:{verCode:"请输入验证码",userName:{required:"请输入用户名",validEmail:"使用邮箱注册必须输入正确格式的邮箱",remote:"用户名已被注册"},password:{required:"请输入密码",rangelength:"密码长度应在8至20个字符之间",validPassword:"密码不能包含特殊字符"},password2:{required:"请再次输入密码",equalTo:"两次输入密码不一致，请重新输入"},nickName:{required:"请输入用户笔名",rangelength:"笔名长度应该2至12个字符之间",remote:"笔名已被注册"}},submitHandler:function(e){$("#submit_btn").attr("disabled",!0),Ajax.formAjaxSubmit(e,function(e){if("success"==e.result)location.href=CONTEXT_PATH+"/regOk";else{layer.alert(e.responseData,{icon:5});var t=(new Date).valueOf();$("#codeImg").attr("src",CONTEXT_PATH+"/verifycode/rand4?timestamp="+t),$("#verCode").val("")}$("#submit_btn").attr("disabled",!1)})}})},User.initCompUserRegPage=function(){$("#regForm").validate({rules:{verCode:"required",userName:{required:!0,validPhone:!0,remote:{url:CONTEXT_PATH+"/checkPropValid",type:"post",dataType:"json",data:{prop:"userName",value:function(){return $("#userName").val()},regType:2}}},password:{required:!0,rangelength:[8,20],validPassword:!0},password2:{required:!0,equalTo:"#password"},validateCode:"required"},messages:{verCode:"请输入验证码",userName:{required:"请输入用户名",validPhone:"使用手机注册必须使用正确的手机号码",remote:"用户名已被注册"},password:{required:"请输入密码",rangelength:"密码长度应在8至20个字符之间",validPassword:"密码不能包含特殊字符"},password2:{required:"请再次输入密码",equalTo:"两次输入密码不一致，请重新输入"},validateCode:"请输入手机验证码"},submitHandler:function(e){$("#submit_btn").attr("disabled",!0),Ajax.formAjaxSubmit(e,function(e){if("success"==e.result)layer.msg("注册成功，请继续完善资料...",{time:1e3,icon:6},function(){location.href=CONTEXT_PATH+"/regcomp/forward"});else{layer.alert(e.responseData,{icon:5});var t=(new Date).valueOf();$("#codeImg").attr("src",CONTEXT_PATH+"/verifycode/rand4?timestamp="+t),$("#verCode").val("")}$("#submit_btn").attr("disabled",!1)})}}),$("#btn_getCode").click(function(){if(wait_tmp==wait_max){var e=$("#verCode").val(),t=$("#userName").val();if(""==t)return layer.alert("请输入手机号码！",{icon:5}),!1;if(""==e)return layer.alert("请输入验证码！",{icon:5}),!1;Ajax.post(CONTEXT_PATH+"/getCode","phoneNum="+t+"&verCode="+e,function(e){if("success"!=e.result)return 1301==e.responseData?layer.tips("该用户名已被注册","#userName",{time:5e3,tips:[2,"#FF6666"]}):1009==e.responseData?layer.tips("2分钟内不能重复发送验证码","#userName",{time:5e3,tips:[1,"#FF6666"]}):1010==e.responseData?layer.tips("验证码发送已达规定次数","#userName",{time:5e3,tips:[1,"#FF6666"]}):layer.alert(e.responseData,{icon:5}),!1;layer.msg("获取验证码成功",{time:1e3,icon:6});var t=$("#btn_getCode");t.addClass("send"),wait_tmp==wait_max&&User.time(t)})}}),$("#refreshImg").click(function(){var e=(new Date).valueOf();$("#codeImg").attr("src",CONTEXT_PATH+"/verifycode/rand4?t="+e)})},User.initCompUserRegInfoPage=function(){$("#editInfoForm").validate({rules:{certInfo:{required:!0,maxBLen:60},compName:{required:!0,maxBLen:40},socialCreditCode:{required:!0,maxlength:18,minlength:18},industryType:{required:!0},compSize:{required:!0},compAddress:{required:!0,maxBLen:100},contact:{required:!0,maxBLen:20},contactPhone:{required:!0,validPhone:!0},idcardFrontUploadFile:"required",idcardBackUploadFile:"required",licenceUploadFiles:"required",letterUploadFiles:"required"},messages:{certInfo:{required:"请输入认证信息",maxBLen:"认证信息不能超过30字"},compName:{required:"请输入公司名称",maxBLen:"公司名称过长"},socialCreditCode:{required:"请输入社会信用代码",maxlength:"社会信用代码不符合格式",minlength:"社会信用代码不符合格式"},industryType:{required:"请输入行业类别"},compSize:{required:"请输入公司规模"},compAddress:{required:"请输入公司地址",maxBLen:"公司地址内容过长"},contact:{required:"请输入联系人姓名",maxBLen:"请输入正确的联系人姓名"},contactPhone:{required:"请输入联系人手机",validPhone:"请输入正确的联系人手机"},idcardFrontUploadFile:"请上传身份证号正面照片",idcardBackUploadFile:"请上传身份证号反面照片",licenceUploadFiles:"请上传企业工商营业执照照片",letterUploadFiles:"请上传认证公函照片"},submitHandler:function(e){layer.confirm("确认要提交填写的资料吗？",function(){$("#submit_btn").attr("disabled",!0),Ajax.formAjaxSubmit(e,function(e){"success"==e.result?layer.msg("提交成功！",{time:1e3,icon:6},function(){location.href=CONTEXT_PATH+"/regcomp/forward"}):"USR0014"==e.responseData?layer.alert("资料已提交过，请勿重复提交",{icon:5}):"USR0013"==e.responseData?layer.alert("您提交的资料信息有误",{icon:5}):"USR006"==e.responseData?layer.alert("您提交的资料不完整",{icon:5}):(layer.alert("提交失败",{icon:5}),console.log(e.responseData)),$("#submit_btn").attr("disabled",!1)})})}})},User.initCompUserRegInfoResubPage=function(){var e=$("#editInfoForm").serializeArray(),r=JSON.stringify(e);$("#editInfoForm").validate({rules:{certInfo:{required:!0,maxBLen:60},compName:{required:!0,maxBLen:40},socialCreditCode:{required:!0,maxlength:18,minlength:18},industryType:{required:!0},compSize:{required:!0},compAddress:{required:!0,maxBLen:100},contact:{required:!0,maxBLen:20},contactPhone:{required:!0,validPhone:!0}},messages:{certInfo:{required:"请输入认证信息",maxBLen:"认证信息不能超过30字"},compName:{required:"请输入公司名称",maxBLen:"公司名称过长"},socialCreditCode:{required:"请输入社会信用代码",maxlength:"社会信用代码不符合格式",minlength:"社会信用代码不符合格式"},industryType:{required:"请输入行业类别"},compSize:{required:"请输入公司规模"},compAddress:{required:"请输入公司地址",maxBLen:"公司地址内容过长"},contact:{required:"请输入联系人姓名",maxBLen:"请输入正确的联系人姓名"},contactPhone:{required:"请输入联系人手机",validPhone:"请输入正确的联系人手机"}},submitHandler:function(e){var t=$("#editInfoForm").serializeArray(),a=JSON.stringify(t);r!=a?layer.confirm("确认要提交填写的资料吗？",function(){$("#submit_btn").attr("disabled",!0),Ajax.formAjaxSubmit(e,function(e){"success"==e.result?layer.msg("提交成功！",{time:1e3,icon:6},function(){location.href=CONTEXT_PATH+"/regcomp/forward"}):"USR0014"==e.responseData?layer.alert("资料已提交过，请勿重复提交",{icon:5}):"USR0013"==e.responseData?layer.alert("您提交的资料信息有误",{icon:5}):"USR006"==e.responseData?layer.alert("您提交的资料不完整",{icon:5}):(layer.alert("提交失败",{icon:5}),console.log(e.responseData)),$("#submit_btn").attr("disabled",!1)})}):layer.alert("您未修改资料，请您修改后再提交",{icon:5})}})},User.initUserCompRejectInfo=function(rejectInfo){var reject=eval("("+rejectInfo+")");for(var key in reject)if(-1==key.indexOf("RejectInfo")&&-1==key.indexOf("RejectInfoExt")&&reject[key]){"idcardAttachReject"==key?($("#idcardAttachFrontArea").css("border","1px red solid"),$("#idcardAttachBackArea").css("border","1px red solid")):"licenceAttachReject"==key||"letterAttachReject"==key?$("#compAttachArea").css("border","1px red solid"):$("#"+key.replace("Reject","")).css("border","1px red solid");var value=reject[key+"Info"];"其他"==value&&(value=reject[key+"InfoExt"]),""!=value&&("certInfoReject"==key?$(".height01").css("height","190px"):"idcardAttachReject"==key?$(".height02").css("height","340px"):"licenceAttachReject"!=key&&"letterAttachReject"!=key&&($("#"+key+"Info").parent().css("height","108px"),$("#"+key+"Info").parent().prev().css("height","108px")),$("#"+key+"Info").html("拒绝理由："+value))}},User.initLoginPage=function(e){var t={},a={};e&&1===parseInt(e)?(t={userName:"required",password:"required"},a={userName:"请输入登录名",password:"请输入登录密码"}):e&&2===parseInt(e)&&(t={userName:"required",password:"required"},a={userName:"请输入手机号",password:"请输入验证码"}),$("#loginform").validate({rules:t,messages:a,submitHandler:function(e){$("#submit_btn").attr("disabled",!0);var t=md5($("#password").val());$("#password").val(t),Ajax.formAjaxSubmit(e,function(e){if("success"==e.result){var t=e.responseData;console.info("map",t),"yes"==t.needcertif?layer.msg("请先进行手机绑定，正在跳转...",{time:1e3,icon:6,shade:.01},function(){location.href=CONTEXT_PATH+"/certif?retUrl="+t.referer}):"1"==t.state?(console.info("map.referer",t.referer),t.referer?layer.msg("登录成功，正在跳转...",{time:1e3,icon:6,shade:.01},function(){location.href=t.referer}):(console.info("http://liuyan.people.com.cn/static/www/js/map.org",t.org),"1"==t.org||"2"==t.org||"3"==t.org||"4"http://liuyan.people.com.cn/static/www/js/==t.org?location.href=CONTEXT_PATH+"/user/ucenter":location.href=CONTEXT_PATH+"/home")):layer.msg("登录成功，正在跳转...",{time:1e3,icon:6,shade:.01},function(){location.href=CONTEXT_PATH+"/regcomp/forward"})}else 0==e.responseData?layer.alert("登录失败次数过多，请稍后再试！",{icon:5}):"T0013"==e.responseData?layer.alert("验证码错误",{icon:5}):"T0019"==e.responseData?layer.alert("验证码失效",{icon:5}):2==e.responseData?layer.alert("登录失败，输入的用户名或密码错误",{icon:5},function(e){location.reload()}):22==e.responseData?layer.alert("登录失败，输入的手机号或验证码错误",{icon:5},function(e){location.reload()}):4==e.responseData?layer.alert("登录失败，输入的用户名或密码错误，您登录失败次数已达到四次，如再次登录失败账号将被锁定15分钟！",{icon:5}):24==e.responseData?layer.alert("登录失败，输入的手机号或验证码错误，您登录失败次数已达到四次，如再次登录失败账号将被锁定15分钟！",{icon:5}):"USR0028"==e.responseData?layer.alert("账号异常，请联系客服4008100300",{icon:5}):layer.alert("登录失败，输入的用户名或密码错误",{icon:5}),$("#password_input").val(""),0<$("#randCode").length&&($("#randCode").val(""),$("#codeImg").click());$("#submit_btn").attr("disabled",!1)})}})},User.getUserMsgCount=function(){Ajax.get(CONTEXT_PATH+"/user/getUserMsgCount",function(e){"success"==e.result?$("#user_msg_count").html(e.responseData):$("#user_msg_count").html("0")})},User.getResultInfo=function(e){if(1!=e.alertType)return"";var t="";return 100==e.alertAction?t+="已展示":101==e.alertAction?t+="未展示":102==e.alertAction?t+="可能和其他留言重复，暂未展示":103==e.alertAction?t+="已展示":104==e.alertAction?t+="未展示":105==e.alertAction?t+="未展示":106==e.alertAction?t+="已经上传成功，我们将把各界建议进行集中整理，并择选部分内容进行公开发布，感谢您的支持和参与！":107==e.alertAction?t+="未展示":110==e.alertAction?t+="其中涉及个人信息或其他不便公开展示的内容已做处理。您的原始留言内容已全部备份，供办理机构查看。":200==e.alertAction?t+="已被回复":201==e.alertAction?t+="回复被更新了":202==e.alertAction?t+="评价被回复了":203==e.alertAction?t+="评价回复被更改了":300==e.alertAction?t+="已被领导批示":301==e.alertAction?t+="领导批示更新了":400==e.alertAction?t+="评价已展示":401==e.alertAction?t+="评价未展示":402==e.alertAction?t+="评价未展示":403==e.alertAction?t+="其中涉及个人信息或其他不便公开展示的内容已做处理。原始评价内容已全部备份，供办理机构查看。":500==e.alertAction?t+="已转交下级办理":501==e.alertAction?t+="已取消交办":502==e.alertAction?t+="已接收正在办理中":503==e.alertAction?t+="已取消办理":600==e.alertAction?t+="复核通过":800==e.alertAction&&(t+="已经更换领导板块"),t},User.showTips=function(e){layer.tips("收藏","#fav_"+e,{time:1e3,tips:[1,"#FF6666"]})},User.addFav=function(t){Ajax.post(CONTEXT_PATH+"/user/checkFav?referer="+window.location.href,{tid:t},function(e){"success"===e.result&&(0===e.responseData?Ajax.post(CONTEXT_PATH+"/user/addFav",{tid:t},function(e){"success"==e.result&&(layer.tips("收藏成功！","#fav_"+t,{time:1e3,tips:[1,"#FF6666"]}),$("#fav_"+t).find("img").attr("src",CONTEXT_PATH+"/static/www/images/collect_true.png"),$("#fav_num_"+t).html(parseInt($("#fav_num_"+t).html())+1))}):1===e.responseData&&Ajax.post(CONTEXT_PATH+"/user/cancelFav",{tid:t},function(e){"success"==e.result&&(layer.tips("已取消收藏！","#fav_"+t,{time:1e3,tips:[1,"#FF6666"]}),$("#fav_"+t).find("img").attr("src",CONTEXT_PATH+"/static/www/images/collect_false.png"),$("#fav_num_"+t).html(parseInt($("#fav_num_"+t).html())-1))}))})},User.cancelFav=function(t){layer.confirm("确定要取消收藏该留言吗？",{icon:3,title:"操作"},function(e){Ajax.post(CONTEXT_PATH+"/user/cancelFav",{tid:t},function(e){"success"==e.result&&layer.msg("操作成功！",{time:1e3,icon:6},function(){location.reload()})}),layer.close(e)})},User.initUserFavoritePage=function(){var e=Common.getPageParamsByAnchor().page;$("#pager").sjAjaxPager({url:CONTEXT_PATH+"/user/queryFavors",pageSize:10,pageIndex:e,totalCount:-1,beforeSend:function(){$("#list_content").empty(),$("#list_content").append("<div style='text-align:center' id='loading_img'><img src='-+CONTEXT_PATH+-/static/www/images/loading.gif'/*tpa=http://liuyan.people.com.cn/static/www/js/"+CONTEXT_PATH+"/static/www/images/loading.gif*/ /></div>")},success:function(e){$("#loading_img").remove(),0<e.responseData.total?$.each(e.responseData.rows,function(e,t){$("#list_content").append(tmpl("threads_content_tpl",t.threads))}):$("#list_content").append("<div style='text-align:center'>未查询到结果</div>")},complete:function(){Common.addAnchorByAjaxPageParams()}})};